<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Audio front-end (AFE) middleware library: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Audio front-end (AFE) middleware library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >AFE is an agnostic audio processing technology that allows a more accurate recognition of voice commands (far-field or close field) by removing the inference sound captured from the microphone. It extracts user's voice and cancels out an unintended sound to provide the clear speech recognition and better wake word detection.</p>
<p ><img src="afe_diagram.png" alt="" width="900cm" height="280cm" class="inline" title="Audio front end"/></p>
<p >As shown in the above block diagram, Audio front end middleware comprises of various algorithms supported internally as below.</p><ul>
<li>Beamforming (BF) : Uses two or more microphones to form a spatial filter that can extract a signal from a specific direction and reduce the contamination of signals from other directions.</li>
<li>Noise suppression (NS) : Reduces the stationary background noise.</li>
<li>Acoustic Echo Cancellation (AEC) : Cancels the acoustic feedback between a speaker and a microphone. Audio data which is being played to speaker is fed back as reference data to AEC algorithm to remove out the acoustic effect of an audio.</li>
<li>Dereverberation (DR) : Removes the reverberation effect from sound.</li>
</ul>
<p >Audio front-end middleware provides easy-to-use APIs to feed the audio data that are filtered internally by cleaning up the audio and then clean audio signals are given back to user application. Audio front-end configurator GUI tool is provided along with the ModusToolbox&trade; IDE using which various components can be configured by the user and it generates (*.c/.h*) file which can be compiled along with the audio front-end middleware to configure various algorithms.</p>
<h1><a class="anchor" id="section_features"></a>
Features</h1>
<ul>
<li>AFE middleware supports NS, AEC, BF, and DR audio algorithms.</li>
<li>AFE middleware supports option for application to provide its own buffer to fill AFE output data so application can manage the pool of buffers</li>
<li>AFE middleware supports feeding mono and stereo data.</li>
</ul>
<h1><a class="anchor" id="section_prerequisite"></a>
Prerequisite</h1>
<p >Please refer to <b>README.md</b> for quick start on platforms</p>
<h1><a class="anchor" id="section_code_snippet"></a>
Code Snippets</h1>
<h2><a class="anchor" id="snip1"></a>
Code Snippet 1: Initialize AFE middleware</h2>
<p >This code snippet demonstrates how to initialize audio front end middleware </p><div class="fragment"><div class="line">cy_rslt_t afe_get_output_buffer(<a class="code hl_typedef" href="group__group__afe__typedefs.html#ga220806cbaf3dc3a17af97f68720558ce">cy_afe_t</a> context, uint32_t** output_buffer, <span class="keywordtype">void</span>* user_args)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * User can choose to provide buffer to AFE middleware to fill the AFE output data. Buffer pool manager</span></div>
<div class="line"><span class="comment">     * library can be used to create pool of buffers and use those buffers here to fill afe output data</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">return</span> CY_RSLT_SUCCESS;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cy_rslt_t afe_output(<a class="code hl_typedef" href="group__group__afe__typedefs.html#ga220806cbaf3dc3a17af97f68720558ce">cy_afe_t</a> handle, <a class="code hl_struct" href="structcy__afe__buffer__info__t.html">cy_afe_buffer_info_t</a> *output_buffer_info, <span class="keywordtype">void</span> *user_arg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* AFE output callback is invoked to provide AFE processed data */</span></div>
<div class="line">    <span class="keywordflow">return</span> CY_RSLT_SUCCESS; </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cy_rslt_t snippet_afe_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    cy_rslt_t result = CY_RSLT_SUCCESS;</div>
<div class="line">    <a class="code hl_struct" href="structcy__afe__config__t.html">cy_afe_config_t</a> afe_config = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* AFE_FILTER_SETTINGS are generated in (.c/.h) file by using audio front end configurator tool */</span></div>
<div class="line">    afe_config.<a class="code hl_variable" href="structcy__afe__config__t.html#a23276dd3f65401e7c1d7cee4c8c99816">filter_settings</a> = AFE_FILTER_SETTINGS;</div>
<div class="line">    <span class="comment">/* AFE middleware settings */</span></div>
<div class="line">    afe_config.<a class="code hl_variable" href="structcy__afe__config__t.html#aa61a0f89c550870beb5b8155be44d83b">mw_settings</a> = AFE_MW_SETTINGS;</div>
<div class="line">    <span class="comment">/* AFE callback to provide buffer to fill AFE output data */</span></div>
<div class="line">    afe_config.<a class="code hl_variable" href="structcy__afe__config__t.html#a1979ce8e7b3450fd92c9181f0369f313">afe_get_buffer_callback</a> = afe_get_output_buffer;</div>
<div class="line">    <span class="comment">/* AFE output callback to get AFE output data */</span></div>
<div class="line">    afe_config.<a class="code hl_variable" href="structcy__afe__config__t.html#a511f770e4f0b0a58704922ba074bc482">afe_output_callback</a> = afe_output;</div>
<div class="line">    <span class="comment">/* Optional user argument */</span></div>
<div class="line">    afe_config.<a class="code hl_variable" href="structcy__afe__config__t.html#ac99f38496157b9517e3f49110ddab19e">user_arg_callbacks</a> = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create AFE instance with the configuration */</span></div>
<div class="line">    result = <a class="code hl_function" href="group__group__afe__functions.html#ga7cb46c483a40eebbf22061da8d3da6e2">cy_afe_create</a>(&amp;afe_config, &amp;afe_app_context);</div>
<div class="line">    <span class="keywordflow">if</span>(CY_RSLT_SUCCESS != result)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;AFE create fail&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> result;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__group__afe__functions_html_ga7cb46c483a40eebbf22061da8d3da6e2"><div class="ttname"><a href="group__group__afe__functions.html#ga7cb46c483a40eebbf22061da8d3da6e2">cy_afe_create</a></div><div class="ttdeci">cy_rslt_t cy_afe_create(cy_afe_config_t *config_init, cy_afe_t *handle)</div><div class="ttdoc">Creates an instance of AFE middleware.</div></div>
<div class="ttc" id="agroup__group__afe__typedefs_html_ga220806cbaf3dc3a17af97f68720558ce"><div class="ttname"><a href="group__group__afe__typedefs.html#ga220806cbaf3dc3a17af97f68720558ce">cy_afe_t</a></div><div class="ttdeci">void * cy_afe_t</div><div class="ttdoc">Audio front end handle.</div><div class="ttdef"><b>Definition:</b> cy_audio_front_end.h:82</div></div>
<div class="ttc" id="astructcy__afe__buffer__info__t_html"><div class="ttname"><a href="structcy__afe__buffer__info__t.html">cy_afe_buffer_info_t</a></div><div class="ttdoc">Output buffer structure for filtered audio data.</div><div class="ttdef"><b>Definition:</b> cy_audio_front_end.h:192</div></div>
<div class="ttc" id="astructcy__afe__config__t_html"><div class="ttname"><a href="structcy__afe__config__t.html">cy_afe_config_t</a></div><div class="ttdoc">Audio front end middleware configuration.</div><div class="ttdef"><b>Definition:</b> cy_audio_front_end.h:458</div></div>
<div class="ttc" id="astructcy__afe__config__t_html_a1979ce8e7b3450fd92c9181f0369f313"><div class="ttname"><a href="structcy__afe__config__t.html#a1979ce8e7b3450fd92c9181f0369f313">cy_afe_config_t::afe_get_buffer_callback</a></div><div class="ttdeci">cy_afe_get_output_buffer_callback_t afe_get_buffer_callback</div><div class="ttdoc">Register callbacks to get the buffer to fill the output data.</div><div class="ttdef"><b>Definition:</b> cy_audio_front_end.h:487</div></div>
<div class="ttc" id="astructcy__afe__config__t_html_a23276dd3f65401e7c1d7cee4c8c99816"><div class="ttname"><a href="structcy__afe__config__t.html#a23276dd3f65401e7c1d7cee4c8c99816">cy_afe_config_t::filter_settings</a></div><div class="ttdeci">uint32_t * filter_settings</div><div class="ttdoc">Pointer to filter settings.</div><div class="ttdef"><b>Definition:</b> cy_audio_front_end.h:462</div></div>
<div class="ttc" id="astructcy__afe__config__t_html_a511f770e4f0b0a58704922ba074bc482"><div class="ttname"><a href="structcy__afe__config__t.html#a511f770e4f0b0a58704922ba074bc482">cy_afe_config_t::afe_output_callback</a></div><div class="ttdeci">cy_afe_output_callback_t afe_output_callback</div><div class="ttdoc">User must pass the output callback to get the output data from AFE middleware.</div><div class="ttdef"><b>Definition:</b> cy_audio_front_end.h:475</div></div>
<div class="ttc" id="astructcy__afe__config__t_html_aa61a0f89c550870beb5b8155be44d83b"><div class="ttname"><a href="structcy__afe__config__t.html#aa61a0f89c550870beb5b8155be44d83b">cy_afe_config_t::mw_settings</a></div><div class="ttdeci">uint8_t * mw_settings</div><div class="ttdoc">Pointer to middleware specific settings.</div><div class="ttdef"><b>Definition:</b> cy_audio_front_end.h:467</div></div>
<div class="ttc" id="astructcy__afe__config__t_html_ac99f38496157b9517e3f49110ddab19e"><div class="ttname"><a href="structcy__afe__config__t.html#ac99f38496157b9517e3f49110ddab19e">cy_afe_config_t::user_arg_callbacks</a></div><div class="ttdeci">void * user_arg_callbacks</div><div class="ttdoc">Optional user argument which can be passed and provided back in the callbacks by middleware.</div><div class="ttdef"><b>Definition:</b> cy_audio_front_end.h:490</div></div>
</div><!-- fragment --><h2><a class="anchor" id="snip2"></a>
Code Snippet 2: Feed audio data to AFE middleware</h2>
<p >This code snippet demonstrates how to feed audio data to AFE middleware </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_afe_feed()</div>
<div class="line">{</div>
<div class="line">    cy_rslt_t result = CY_RSLT_SUCCESS;</div>
<div class="line">    int16_t* input_buffer = NULL;</div>
<div class="line">    int16_t* aec_ref_buf = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Add code to initialize AFE middleware (check above code snippet) */</span></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Fill input_buffer to feed audio data.</span></div>
<div class="line"><span class="comment">     * Note: In case of stereo, 1st 320 bytes from channel1 &amp; next set of 320 bytes will be from channel2.</span></div>
<div class="line"><span class="comment">     * In case of mono audio, 320 bytes will be passed.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * AEC reference data need to be fed only when AEC is enabled.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    result = <a class="code hl_function" href="group__group__afe__functions.html#gae7e8497a950ea9bcbedc64d5aca98e08">cy_afe_feed</a>(afe_app_context, input_buffer, aec_ref_buf);</div>
<div class="line">    <span class="keywordflow">if</span>(CY_RSLT_SUCCESS != result)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;AFE feed fail&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__group__afe__functions_html_gae7e8497a950ea9bcbedc64d5aca98e08"><div class="ttname"><a href="group__group__afe__functions.html#gae7e8497a950ea9bcbedc64d5aca98e08">cy_afe_feed</a></div><div class="ttdeci">cy_rslt_t cy_afe_feed(cy_afe_t handle, CY_AFE_DATA_T *input_buffer, CY_AFE_DATA_T *aec_ref)</div><div class="ttdoc">Feed the audio data to audio front end middleware (10ms worth of data)</div></div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>Audio front-end (AFE) middleware library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
</body>
</html>
